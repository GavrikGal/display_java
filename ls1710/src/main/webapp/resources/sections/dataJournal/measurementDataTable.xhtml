<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:component="http://java.sun.com/jsf/composite/components/dataJournal">


	
	<!-- таблица данных с измерениями. 
	подключаем секцию с таблицей данных об измерениях, 
	эта и подключаемая страница связаны через атрибут 
	update="measurementForViews" контекстного меню и
	id="measurementForViews" таблицы данных -->
	<p:dataTable id="measurementForViews" var="measurementForView"
		value="#{listOfDataJournalView.measurementForViews}"
		rowKey="#{measurementForView.id}"
		selection="#{listOfDataJournalView.selectedMeasurementForView}"
		selectionMode="single" rowStyleClass="measurement-table-rows"
		sortBy="#{measurementForView.id}" sortOrder="descending"
		widgetVar="measurementForViewsTable"
		emptyMessage="#{msg['label_measurement_table_empty']}"
		filteredValue="#{listOfDataJournalView.filteredMeasurementForViews}"
		lazy="false">
		
		<p:column width="70"
			filterBy="#{measurementForView.firstDateOfMeasurement.date}"
			filterMatchMode="contains">
			<f:facet name="header">
				<h:outputText value="#{msg['label_measurement_table_date']}" />
			</f:facet>
			<f:facet name="filter">
				<p:inputText onkeyup="PF('measurementForViewsTable').filter()"
					style="width: 70px;margin-top:3px;" />
			</f:facet>
			<h:outputText rendered="#{measurementForView.enableFirstDate}"
				value="#{measurementForView.firstDateOfMeasurement.date}">
				<f:converter converterId="jodaDataTimeConverter" />
				<f:attribute name="pattern" value="#{msg['date_format_pattern']}" />
			</h:outputText>
		</p:column>
		<p:column width="80"
			filterBy="#{measurementForView.equipment.model.name}"
			filterMatchMode="contains">
			<f:facet name="header">
				<h:outputText value="#{msg['label_measurement_table_model']}" />
			</f:facet>
			<f:facet name="filter">
				<p:inputText onkeyup="PF('measurementForViewsTable').filter()"
					style="width: 80px;margin-top:3px;" />
			</f:facet>
			<h:outputText value="#{measurementForView.equipment.model.name}"
				rendered="#{measurementForView.enableModelName}" />
		</p:column>
		<p:column width="100"
			filterBy="#{measurementForView.equipment.serialNumber}"
			filterMatchMode="contains">
			<f:facet name="header">
				<h:outputText
					value="#{msg['label_measurement_table_serial_number']}" />
			</f:facet>
			<f:facet name="filter">
				<p:inputText onkeyup="PF('measurementForViewsTable').filter()"
					style="width: 100px;margin-top:3px;" />
			</f:facet>
			<h:outputText value="#{measurementForView.equipment.serialNumber}" />
		</p:column>
		<p:column headerText="#{msg['label_measurement_table_spectrum']}">
			<p:dataGrid var="spectrum"
				value="#{measurementForView.lastSpectrums}" columns="1" rows="2"
				id="spectrums" paginator="false" styleClass="internalTable">
				<component:spectrumRow spectrum="#{spectrum}"
					widthFirstColumn="140px" />
			</p:dataGrid>
		</p:column>
		<p:column width="20" styleClass="internalTable"
			style="border-left: 0px solid #E55 ">
			<p:rowToggler
				rendered="#{fn:length(measurementForView.lastSpectrums) > 2}" />
		</p:column>
		<p:column width="70"
			filterBy="#{measurementForView.lastDateOfMeasurement.date}"
			filterMatchMode="contains">
			<f:facet name="header">
				<h:outputText value="#{msg['label_measurement_table_second_date']}" />
			</f:facet>
			<f:facet name="filter">
				<p:inputText onkeyup="PF('measurementForViewsTable').filter()"
					style="width: 70px;margin-top:3px;" />
			</f:facet>
			<h:outputText
				value="#{measurementForView.lastDateOfMeasurement.date}">
				<f:converter converterId="jodaDataTimeConverter" />
				<f:attribute name="pattern" value="#{msg['date_format_pattern']}" />
			</h:outputText>
		</p:column>
		<p:column headerText="#{msg['label_measurement_table_user']}"
			width="80">
			<h:outputText value="#{measurementForView.user.lastName}" />
		</p:column>


		<p:rowExpansion styleClass="expansionTable">
			<p:panelGrid>
				<p:row>
					<p:column style="width: 291px" />
					<p:column>
						<p:dataGrid var="moreSpectrum"
							value="#{measurementForView.lastSpectrums}" columns="1" rows="2"
							id="moreSpectrums" paginator="false" styleClass="internalTable"
							first="2">
							<component:spectrumRow spectrum="#{moreSpectrum}"
								widthFirstColumn="140px" />
						</p:dataGrid>
					</p:column>
					<p:column style="width: 170px" />
				</p:row>
			</p:panelGrid>
		</p:rowExpansion>
	</p:dataTable>

</ui:composition>