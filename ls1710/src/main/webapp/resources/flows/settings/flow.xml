<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/webflow
        http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd">

	<view-state 
		id="settings" 
		view="/resources/views/settings/settings.xhtml">
		
		<on-entry>
			<evaluate expression="settingsController.newUsersSetting()"
				result="flowScope.usersSetting" />
			<evaluate expression="settingsController.newNormsSetting()"
				result="flowScope.normsSetting" />
			<evaluate 
				expression="settingsController.getCurrentUser()"
				result="flowScope.currentUserDetails" />
		</on-entry>
		
		<transition 
			on="addUser"
			to="addUser-step-1">
			<evaluate expression="usersSetting.newUser()" />
		</transition>
		
		<transition 
			on="editUser" 
			to="addUser-step-1">
		</transition>
		
		<transition
			on="changeLogin"
			to="changeLogin">
		
		</transition>
		
		<transition on="logout" to="logout"/>

	</view-state>
	
	<view-state id="addUser-step-1" view="/resources/views/settings/sections/addUser-step-1.xhtml">
		<transition 
			on="next"
			to="addUser-step-2">
		</transition>
		<transition
			on="back"
			to="settings">
		</transition>
	</view-state>
	
	<view-state id="addUser-step-2" view="/resources/views/settings/sections/addUser-step-2.xhtml">
		<transition 
			on="next"
			to="addUser-confirm">
		</transition>
		<transition
			on="back"
			to="addUser-step-1">
		</transition>
	</view-state>
	
	<view-state id="addUser-confirm" view="/resources/views/settings/sections/addUser-confirm.xhtml">
		<transition 
			on="next"
			to="settings">
			<evaluate expression="settingsController.saveUser(flowRequestContext)" />
		</transition>
		<transition
			on="back"
			to="addUser-step-2">
		</transition>
	</view-state>
	
	<view-state id="logout" view="flowRedirect:/dataJournal">
	</view-state>
	
	<view-state id="changeLogin" view="/resources/views/settings/sections/changeLogin-step-1.xhtml">
		<transition
			on="changeLogin"
			to="settings" >
			<evaluate expression="settingsController.changeLogin(flowRequestContext)"></evaluate>
		</transition>
	</view-state>
	

	
	
	

	<global-transitions>
		<transition 
			on="cancel" 
			to="settings" />
	</global-transitions>

</flow>